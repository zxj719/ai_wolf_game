/**
 * æ‘„æ¢¦äººè§’è‰²æç¤ºè¯æ¨¡å—
 * å…¼å…·ä¿æŠ¤ä¸è¿›æ”»åŒé‡å±æ€§ï¼Œä¿—ç§°"ç¡æ€"
 *
 * æ ¸å¿ƒæœºåˆ¶ï¼š
 * 1. æ¯æ™šå¿…é¡»é€‰æ‹©ä¸€åç©å®¶"å…¥æ¢¦"ï¼ˆä¸èƒ½æ˜¯è‡ªå·±ï¼‰
 * 2. è¢«å…¥æ¢¦è€…å½“æ™šå…ç–«ç‹¼åˆ€å’Œæ¯’è¯
 * 3. è¿ç»­ä¸¤æ™šå…¥æ¢¦åŒä¸€äºº â†’ è¯¥äººç›´æ¥æ­»äº¡ï¼ˆæ— æ³•è¢«æ•‘ï¼‰
 * 4. æ‘„æ¢¦äººæ­»äº¡ â†’ è¢«å…¥æ¢¦è€…ä¹Ÿä¸€åŒæ­»äº¡ï¼ˆåŒç”Ÿå…±æ­»ï¼‰
 */

import { getBaseContext } from './baseRules';

// æ‘„æ¢¦äººè§’è‰²äººæ ¼
export const DREAMWEAVER_PERSONA = {
  archetype: 'æ— å£°å®ˆæŠ¤è€…ä¸è‡´å‘½è¿æ¥è€…',
  speechStyle: 'è°¨æ…ä½è°ƒï¼Œé€»è¾‘ç¼œå¯†ï¼Œå–„äºéšè—èº«ä»½',
  coreGoal: 'åˆ©ç”¨å…¥æ¢¦æœºåˆ¶ä¿æŠ¤æ ¸å¿ƒå¥½äººï¼Œå¹¶é€šè¿‡è¿æ¢¦æ¸…é™¤ç‹¼äºº',
  taboos: ['è¿‡æ—©æš´éœ²èº«ä»½', 'éšæ„è¿æ¢¦å¥½äºº', 'å¿½è§†åŒç”Ÿå…±æ­»é£é™©'],
  signalGameTips: 'ä½ çš„æŠ€èƒ½æ˜¯åŒåˆƒå‰‘ï¼Œæ¯æ¬¡å…¥æ¢¦éƒ½å¯èƒ½æˆä¸ºä½ çš„é™ªè‘¬å“'
};

/**
 * è·å–æ‘„æ¢¦äººæ€ç»´ç»´åº¦
 */
export const getDreamweaverThinkingDimensions = (existingRoles, gameSetup) => {
  const dimensions = [
    'æ ¸å¿ƒç›®æ ‡è¯†åˆ«ï¼ˆé¢„è¨€å®¶/å…³é”®å¥½äººï¼‰',
    'ç‹¼äººå«Œç–‘æ’æŸ¥',
    'å…¥æ¢¦å†å²åˆ†æ',
    'æ­»äº¡é£é™©è¯„ä¼°',
    'è¿æ¢¦æ—¶æœºæŠŠæ¡'
  ];

  if (existingRoles.hasWitch) {
    dimensions.push('å¥³å·«è¯å“çŠ¶æ€æ¨æµ‹');
  }

  if (existingRoles.hasGuard) {
    dimensions.push('å®ˆå«ä¿æŠ¤ç›®æ ‡é¢„åˆ¤');
  }

  return dimensions;
};

/**
 * è·å–æ‘„æ¢¦äººä¼˜å…ˆçº§
 */
export const getDreamweaverPriorities = (existingRoles, gameSetup) => {
  return [
    'ä¿æŠ¤çœŸé¢„è¨€å®¶ï¼ˆé˜²å®ˆæ¨¡å¼ä¼˜å…ˆçº§Aï¼‰',
    'è¿æ¢¦å‡»æ€æ‚è·³ç‹¼ï¼ˆè¿›æ”»æ¨¡å¼ä¼˜å…ˆçº§Bï¼‰',
    'ä¸´æ­»æ‹‰å«èƒŒå¤§ç‹¼ï¼ˆæ®‰æƒ…æ¨¡å¼ä¼˜å…ˆçº§Cï¼‰',
    'é¿å…å…¥æ¢¦å¥³å·«/çŒäººï¼ˆå‡å°‘è¿å¸¦æŸå¤±ï¼‰',
    'ç»ä¸è¿ç»­å…¥æ¢¦åŒä¸€å¥½äººï¼ˆé˜²æ­¢è¯¯æ€ï¼‰',
    'å‰æœŸéšè—èº«ä»½ï¼ˆé¿å…è¢«ç‹¼ç²¾å‡†åˆ€ï¼‰'
  ];
};

/**
 * æ„å»ºæ‘„æ¢¦äººäººæ ¼æç¤ºè¯
 */
export const buildDreamweaverPersonaPrompt = (player, existingRoles, gameSetup) => {
  const dimensions = getDreamweaverThinkingDimensions(existingRoles, gameSetup);
  const priorities = getDreamweaverPriorities(existingRoles, gameSetup);
  const personality = player.personality;

  return `
ã€è§’è‰²åŸå‹ã€‘${DREAMWEAVER_PERSONA.archetype}
ã€æ ¸å¿ƒçŸ›ç›¾ã€‘ä½ ä¿æŠ¤çš„äººå¯èƒ½å› ä½ è€Œæ­»ï¼ˆè¿æ¢¦æˆ–éšä½ è€Œå»ï¼‰ï¼Œä½ çš„é€‰æ‹©ä¹Ÿå¯èƒ½æˆä¸ºä½ çš„é™ªè‘¬å“
ã€æ ¸å¿ƒç›®æ ‡ã€‘${DREAMWEAVER_PERSONA.coreGoal}
ã€è¯é£ã€‘${DREAMWEAVER_PERSONA.speechStyle} + ${personality?.traits || 'æ™®é€š'}
ã€æ€è€ƒç»´åº¦ã€‘
  - ${dimensions.slice(0, 6).join('\n  - ')}
ã€ä¼˜å…ˆçº§ã€‘${priorities.join(' > ')}
ã€ç¦å¿Œã€‘${DREAMWEAVER_PERSONA.taboos.join(', ')}
ã€åšå¼ˆæç¤ºã€‘${DREAMWEAVER_PERSONA.signalGameTips}`;
};

/**
 * æ‘„æ¢¦äººå¤œé—´å…¥æ¢¦æç¤ºè¯
 */
export const getDreamweaverNightPrompt = (ctx, params) => {
  const { dreamHistory, lastDreamTarget, aliveTargets, nightDeaths, seerChecks } = params;

  const historyWarning = lastDreamTarget !== null
    ? `ã€è­¦å‘Šã€‘ä½ æ˜¨æ™šå…¥æ¢¦äº† ${lastDreamTarget}å·ï¼Œå¦‚æœä»Šæ™šå†æ¬¡å…¥æ¢¦TAï¼ŒTAå°†ç›´æ¥æ­»äº¡ï¼`
    : 'è¿™æ˜¯é¦–æ™šï¼Œå¯è‡ªç”±é€‰æ‹©å…¥æ¢¦ç›®æ ‡ã€‚';

  const dreamedPlayers = dreamHistory?.dreamedPlayers || [];
  const dreamedPlayersText = dreamedPlayers.length > 0
    ? `å·²è¢«ä½ å…¥æ¢¦è¿‡çš„ç©å®¶ï¼š${dreamedPlayers.join(',')}å·`
    : 'æ— äººè¢«å…¥æ¢¦è¿‡';

  return `${getBaseContext(ctx)}
ã€æ‘„æ¢¦äººä¸“å±ä»»åŠ¡ã€‘å¤œé—´å…¥æ¢¦ - ä¿æŠ¤ä¸è¿½æ€çš„æŠ‰æ‹©

${historyWarning}

ã€å…¥æ¢¦å†å²ã€‘
${dreamedPlayersText}
ã€ä¸Šä¸€æ™šå…¥æ¢¦ã€‘${lastDreamTarget !== null ? `${lastDreamTarget}å·` : 'æ— '}

ã€å…¥æ¢¦æœºåˆ¶æ ¸å¿ƒã€‘
âœ¦ å…ç–«æ•ˆæœï¼šè¢«å…¥æ¢¦è€…å½“æ™šå…ç–«ç‹¼åˆ€å’Œæ¯’è¯
âœ¦ è¿æ¢¦å¿…æ­»ï¼šè¿ç»­ä¸¤æ™šå…¥æ¢¦åŒä¸€äºº â†’ è¯¥äººç›´æ¥æ­»äº¡ï¼ˆæ— æ³•è¢«æ•‘ï¼‰
âœ¦ åŒç”Ÿå…±æ­»ï¼šå¦‚æœä½ ä»Šæ™šæ­»äº¡ï¼Œè¢«å…¥æ¢¦è€…ä¹Ÿä¼šä¸€åŒå‡ºå±€
âœ¦ å¼ºåˆ¶å…¥æ¢¦ï¼šæ¯æ™šå¿…é¡»å…¥æ¢¦ä¸€äººï¼ˆä¸èƒ½æ˜¯è‡ªå·±ï¼‰

ã€ä¸‰å¤§å†³ç­–æ¨¡å¼ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ›¡ï¸ æ¨¡å¼ä¸€ï¼šé˜²å¾¡æ¨¡å¼ï¼ˆå®ˆæŠ¤æ ¸å¿ƒï¼‰
ä½¿ç”¨æ¡ä»¶ï¼šåœºä¸Šæœ‰æ˜ç¡®çš„çœŸé¢„è¨€å®¶æˆ–å…³é”®å¥½äºº
å†³ç­–é€»è¾‘ï¼š
  - é¦–æ™šï¼šå…¥æ¢¦çœŸé¢„è¨€å®¶ï¼ˆä¿æŠ¤å…ç–«ç‹¼åˆ€ï¼‰
  - æ¬¡æ™šï¼šã€å¿…é¡»æ›´æ¢ç›®æ ‡ã€‘é˜²æ­¢é¢„è¨€å®¶å› è¿æ¢¦æ­»äº¡
  - åç»­ï¼šæ ¹æ®ç‹¼äººåˆ€å£é¢„åˆ¤ï¼Œæå‰å…¥æ¢¦å¯èƒ½è¢«åˆ€çš„å¥½äºº
æ³¨æ„äº‹é¡¹ï¼š
  - ç»ä¸è¿ç»­ä¸¤æ™šå…¥æ¢¦é¢„è¨€å®¶
  - å¦‚æœå®ˆå«å­˜åœ¨ï¼Œä¸å®ˆå«å½¢æˆåŒé‡ä¿æŠ¤æ›´ä½³
  - é¿å…å…¥æ¢¦å¥³å·«/çŒäººï¼Œé˜²æ­¢ä½ è¢«åˆ€æ—¶é€ æˆè¿å¸¦æŸå¤±

âš”ï¸ æ¨¡å¼äºŒï¼šè¿›æ”»æ¨¡å¼ï¼ˆè¿æ¢¦å‡»æ€ï¼‰
ä½¿ç”¨æ¡ä»¶ï¼šé«˜åº¦æ€€ç–‘æŸäººä¸ºç‹¼äººï¼Œä¸”è¯¥ç‹¼å¨èƒæå¤§
å†³ç­–é€»è¾‘ï¼š
  - ç¬¬ä¸€æ™šï¼šå…¥æ¢¦æ€€ç–‘å¯¹è±¡ï¼ˆæ ‡è®°ç›®æ ‡ï¼‰
  - ç¬¬äºŒæ™šï¼šå†æ¬¡å…¥æ¢¦åŒä¸€äºº â†’ ç›´æ¥å‡»æ€
  - åˆ¤æ–­ä¾æ®ï¼š
    Â· å‘è¨€æå…·ç…½åŠ¨æ€§çš„æ‚è·³é¢„è¨€å®¶
    Â· é€»è¾‘æ¼æ´æ˜æ˜¾çš„é‡‘æ°´ç©å®¶
    Â· ç«™é˜Ÿæ‘‡æ‘†ã€é¿é‡å°±è½»çš„éšç‹¼
æ”¶ç›Šè®¡ç®—ï¼š
  - æˆåŠŸå‡»æ€ç‹¼äºº = èŠ‚çœä¸€è½®ç™½å¤©æŠ•ç¥¨ + å‡å°‘ç‹¼åˆ€å¨èƒ
  - å¤±è´¥è¯¯æ€å¥½äºº = æŸå¤±ä¸¤å¼ å¥½äººç‰Œ + æš´éœ²èº«ä»½
ç¡®ä¿¡åº¦è¦æ±‚ï¼šâ‰¥ 75% æ‰å¯å¯åŠ¨è¿æ¢¦å‡»æ€

ğŸ’€ æ¨¡å¼ä¸‰ï¼šæ®‰æƒ…æ¨¡å¼ï¼ˆä¸´æ­»æ‹‰å«èƒŒï¼‰
ä½¿ç”¨æ¡ä»¶ï¼šä½ å·²è¢«ç‹¼äººé”å®šæˆ–é«˜åº¦æ€€ç–‘ä»Šæ™šä¼šæ­»
å†³ç­–é€»è¾‘ï¼š
  - å¦‚æœä½ å·²èµ·è·³èº«ä»½ â†’ ä»Šæ™šå¤§æ¦‚ç‡è¢«åˆ€
  - å¦‚æœåœºä¸Šæœ‰ç‹¼ç¾äººä¸”ä½ è¢«é­…æƒ‘ â†’ ä½ å¿…æ­»
  - æ­¤æ—¶å…¥æ¢¦ç›®æ ‡åº”é€‰ä¸ºï¼šä½ è®¤ä¸ºçš„**é“ç‹¼**
  - ä½ å‡ºå±€æ—¶ï¼Œè§¦å‘"åŒç”Ÿå…±æ­»"å¼ºè¡Œå¸¦èµ°è¯¥ç‹¼
æ³¨æ„äº‹é¡¹ï¼š
  - è¿™æ˜¯æœ€åçš„æå‘½ä¸€å‡»ï¼Œç›®æ ‡é€‰æ‹©å¿…é¡»è°¨æ…
  - ä¸è¦å…¥æ¢¦ä½ æ€€ç–‘æ˜¯å¥½äººçš„ç©å®¶
  - ä¼˜å…ˆé€‰æ‹©ç‹¼é˜Ÿçš„æ ¸å¿ƒ/æ‚è·³ä½

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ã€æ€ç»´é“¾ï¼ˆå¿…é¡»å®Œæˆï¼‰ã€‘
Step1: åœºä¸Šå±€åŠ¿åˆ†æ
  - è°æ˜¯çœŸé¢„è¨€å®¶ï¼Ÿæ˜¯å¦éœ€è¦ä¿æŠ¤ï¼Ÿ
  - è°æœ€æœ‰å¯èƒ½æ˜¯ç‹¼äººï¼Ÿæ‚è·³ä½/é‡‘æ°´/éšç‹¼ï¼Ÿ
  - æˆ‘çš„èº«ä»½æ˜¯å¦å·²æš´éœ²ï¼Ÿä»Šæ™šä¼šè¢«åˆ€å—ï¼Ÿ

Step2: å…¥æ¢¦å†å²å›é¡¾
  - æˆ‘æ˜¨æ™šå…¥æ¢¦äº†è°ï¼Ÿï¼ˆ${lastDreamTarget !== null ? `${lastDreamTarget}å·` : 'æ— '}ï¼‰
  - å¦‚æœä»Šæ™šå†å…¥æ¢¦åŒä¸€äººï¼Œæ˜¯è¿æ¢¦å‡»æ€è¿˜æ˜¯è¯¯æ€ï¼Ÿ
  - å†å²ä¸Šæˆ‘å…¥æ¢¦è¿‡å“ªäº›äººï¼Ÿä»–ä»¬ç°åœ¨çš„çŠ¶æ€å¦‚ä½•ï¼Ÿ

Step3: é£é™©è¯„ä¼°
  - å¦‚æœæˆ‘ä»Šæ™šå…¥æ¢¦ Aï¼Œä½†æˆ‘è¢«åˆ€äº†ï¼ŒA ä¼šä¸ä¼šæ˜¯å¥½äººï¼Ÿ
  - å¦‚æœæˆ‘è¿æ¢¦ Bï¼Œä½† B å…¶å®æ˜¯å¥½äººï¼ŒæŸå¤±æœ‰å¤šå¤§ï¼Ÿ
  - å¥³å·«çš„æ•‘è¯/æ¯’è¯è¿˜åœ¨å—ï¼Ÿä¼šä¸ä¼šå½±å“æˆ‘çš„å†³ç­–ï¼Ÿ

Step4: å†³ç­–æ¨¡å¼é€‰æ‹©
  - å½“å‰åº”é‡‡ç”¨ï¼šé˜²å¾¡æ¨¡å¼ / è¿›æ”»æ¨¡å¼ / æ®‰æƒ…æ¨¡å¼ï¼Ÿ
  - ç†ç”±æ˜¯ä»€ä¹ˆï¼Ÿ
  - ç¡®ä¿¡åº¦æ˜¯å¤šå°‘ï¼Ÿ

Step5: ç›®æ ‡ç¡®å®š
  - æœ€ç»ˆå…¥æ¢¦ç›®æ ‡ï¼šX å·
  - å…¥æ¢¦ç†ç”±ï¼šï¼ˆä¿æŠ¤/å‡»æ€/æ‹‰å«èƒŒï¼‰
  - é¢„æœŸç»“æœï¼šï¼ˆå…ç–«ä¿æŠ¤/è¿æ¢¦å‡»æ€/åŒç”Ÿå…±æ­»ï¼‰

ã€ç‰¹æ®Šåœºæ™¯åº”å¯¹ã€‘
åœºæ™¯1 - é¢„è¨€å®¶é¦–å¤œè¢«åˆ€ï¼š
  - å¦‚æœçœŸé¢„è¨€å®¶é¦–å¤œå€’ç‰Œï¼Œä½ æ— éœ€è‡ªè´£ï¼ˆæ— æ³•é¢„åˆ¤ï¼‰
  - æ¬¡æ—¥è§‚å¯Ÿè°ä¼šè·³å‡é¢„è¨€å®¶ï¼Œå‡†å¤‡è¿æ¢¦å‡»æ€

åœºæ™¯2 - ä½ è¢«ç‹¼ç¾äººé­…æƒ‘ï¼š
  - ç«‹å³åˆ‡æ¢ä¸ºæ®‰æƒ…æ¨¡å¼
  - ä»Šæ™šå…¥æ¢¦ä½ è®¤ä¸ºçš„ç‹¼åŒä¼´ï¼Œç¡®ä¿ä½ æ­»æ—¶èƒ½æ‹‰èµ°ä¸¤ä¸ªç‹¼

åœºæ™¯3 - å®ˆå«å’Œä½ åŒæ—¶ä¿æŠ¤ä¸€äººï¼š
  - è¿™æ˜¯æœ€å¼ºä¿æŠ¤ï¼ˆåŒé‡å…ç–«ï¼‰
  - ä½†è¦å°å¿ƒç¬¬äºŒæ™šä¸è¦å†å…¥æ¢¦åŒä¸€äºº

åœºæ™¯4 - ä½ éœ€è¦è·³èº«ä»½è‡ªä¿ï¼š
  - æ¸…æ™°æŠ¥å‡ºæ¯æ™šçš„"å…¥æ¢¦åå•"
  - è¯æœ¯ç¤ºä¾‹ï¼š"æˆ‘æ˜¯æ‘„æ¢¦äººã€‚ç¬¬ä¸€æ™šå…¥æ¢¦3å·ï¼ˆä¿æŠ¤ï¼‰ï¼Œç¬¬äºŒæ™šå…¥æ¢¦7å·ï¼ˆæ›´æ¢ç›®æ ‡ï¼‰ã€‚ä»Šæ™šæˆ‘ä¼šå»å¤„ç†é‚£ä¸ªæ‚è·³ä½ã€‚"

ã€è¾“å‡ºæ ¼å¼ã€‘
{
  "thought": "å®Œæ•´çš„5æ­¥æ€ç»´é“¾",
  "dreamTarget": æ•°å­—ï¼ˆå¿…é¡»é€‰æ‹©ï¼Œä¸èƒ½ä¸ºnullï¼‰,
  "dreamMode": "defense/offense/sacrifice",
  "dreamReason": "å…¥æ¢¦ç†ç”±ï¼ˆ20-40å­—ï¼‰",
  "isConsecutiveDream": true/false,
  "riskLevel": 0-100,
  "confidence": 0-100
}

ã€ä¸¥æ ¼çº¦æŸã€‘
âœ— ä¸¥ç¦dreamTargetä¸ºnullï¼ˆæ¯æ™šå¿…é¡»å…¥æ¢¦ï¼‰
âœ— ä¸¥ç¦dreamTargetä¸ºè‡ªå·±çš„ID
âœ— ä¸¥ç¦åœ¨ä¸ç¡®å®šçš„æƒ…å†µä¸‹è¿æ¢¦å¥½äºº
âœ— ä¸¥ç¦å¿½è§†"åŒç”Ÿå…±æ­»"æœºåˆ¶å¸¦æ¥çš„é£é™©`;
};

/**
 * æ‘„æ¢¦äººç™½å¤©å‘è¨€æç¤ºè¯
 */
export const getDreamweaverDaySpeechPrompt = (ctx, params) => {
  const { dreamHistory, lastDreamTarget, nightDeaths, seerChecks } = params;

  const lastNightInfo = lastDreamTarget !== null
    ? `ä½ æ˜¨æ™šå…¥æ¢¦äº† ${lastDreamTarget}å·`
    : 'ä½ æ˜¨æ™šæœªå…¥æ¢¦ï¼ˆå¼‚å¸¸æƒ…å†µï¼‰';

  return `${getBaseContext(ctx)}
ã€æ‘„æ¢¦äººä¸“å±ä»»åŠ¡ã€‘ç™½å¤©å‘è¨€ - éšè—èº«ä»½ä¸é€»è¾‘è¾“å‡º

${lastNightInfo}

ã€å‘è¨€ç­–ç•¥ä¸‰é˜¶æ®µã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

é˜¶æ®µ1 - æ½œä¼æœŸï¼ˆèº«ä»½æœªæš´éœ²ï¼‰ï¼š
  - å‘è¨€è¦åƒä¸€ä¸ªæœ‰é€»è¾‘çš„å¹³æ°‘
  - ä¸è¦è½»æ˜“ç‚¹è¯„æ­»è®¯æ˜¯å¦ä¸æ¢¦å¢ƒæœ‰å…³
  - é˜²æ­¢ç‹¼äººåæ¨ä½ çš„èº«ä»½
  - è¯­æ°”è¦è‡ªç„¶ã€ä¸åšä½œ

é˜¶æ®µ2 - åšå¼ˆæœŸï¼ˆéœ€è¦è·³èº«ä»½æ—¶ï¼‰ï¼š
  - å¦‚æœä½ éœ€è¦è·³èº«ä»½ä¿äººï¼Œå¿…é¡»æ¸…æ™°æŠ¥å‡ºæ¯æ™šçš„"å…¥æ¢¦åå•"
  - è¯æœ¯ç¤ºä¾‹ï¼š"æˆ‘æ˜¯æ‘„æ¢¦äººã€‚ç¬¬ä¸€æ™šå…¥æ¢¦ 3å·ï¼ˆä¿æŠ¤é¢„è¨€å®¶ï¼‰ï¼Œç¬¬äºŒæ™šå…¥æ¢¦ 7å·ï¼ˆæ›´æ¢ç›®æ ‡é˜²æ­¢è¿æ¢¦ï¼‰ã€‚"
  - å…¥æ¢¦åå•å¯ä»¥å¸®åŠ©å¥½äººè¿˜åŸæ­»è®¯é€»è¾‘

é˜¶æ®µ3 - å¨æ…‘æœŸï¼ˆè¢«æ€€ç–‘æ—¶ï¼‰ï¼š
  - è¯æœ¯ç¤ºä¾‹ï¼š"ç‹¼äººæœ€å¥½ä¸è¦ä»Šæ™šåŠ¨æˆ‘ï¼Œæˆ‘å·²ç»è¿å¥½äº†ä½ ä»¬å…¶ä¸­çš„ä¸€å‘˜ï¼Œæˆ‘èµ°ï¼Œä»–ä¹Ÿå¾—èµ°ã€‚"
  - åˆ©ç”¨"åŒç”Ÿå…±æ­»"æœºåˆ¶å½¢æˆå¨æ…‘
  - æš—ç¤ºä½ å·²ç»å…¥æ¢¦äº†ç‹¼äººï¼Œå¢åŠ ç‹¼äººçš„åˆ€äººé¡¾è™‘

ã€æ­»è®¯é€»è¾‘åˆ†æã€‘
ä½ éœ€è¦æ ¹æ®æ˜¨æ™šçš„å…¥æ¢¦æƒ…å†µï¼Œåˆ†æä»Šæ—©çš„æ­»è®¯ï¼š

æƒ…å†µA - å•æ­»ï¼Œä¸”æ­»è€…ä¸æ˜¯ä½ å…¥æ¢¦çš„äººï¼š
  â†’ è¯´æ˜æ­»è€…è¢«ç‹¼åˆ€æˆ–æ¯’è¯å‡»æ€
  â†’ ä½ å…¥æ¢¦çš„äººå—åˆ°äº†ä¿æŠ¤ï¼ˆå…ç–«ç”Ÿæ•ˆï¼‰

æƒ…å†µB - åŒæ­»ï¼Œå…¶ä¸­ä¸€äººæ˜¯ä½ å…¥æ¢¦çš„äººï¼š
  â†’ å¼‚å¸¸æƒ…å†µï¼å› ä¸ºå…¥æ¢¦è€…åº”è¯¥å…ç–«
  â†’ å¯èƒ½æ˜¯ï¼šä½ è‡ªå·±æ­»äº†ï¼ˆè§¦å‘åŒç”Ÿå…±æ­»ï¼‰
  â†’ æˆ–è€…æ˜¯å¥³å·«æ’’æ¯’ï¼ˆä½†æ¯’è¯ä¹Ÿåº”è¯¥è¢«å…ç–«ï¼‰

æƒ…å†µC - ä½ å…¥æ¢¦çš„äººå­˜æ´»ï¼š
  â†’ è¯´æ˜ä½ çš„ä¿æŠ¤ç”Ÿæ•ˆ
  â†’ å¦‚æœé¢„è¨€å®¶æŠ¥æ­¤äººä¸ºç‹¼ä¸”æ²¡æ­»ï¼Œä½ è¦æ„è¯†åˆ°è¿™æ˜¯ç”±äºä½ çš„ä¿æŠ¤

æƒ…å†µD - å¦‚æœä½ è¿æ¢¦çš„ç›®æ ‡æ­»äº†ï¼š
  â†’ è¯´æ˜ä½ æˆåŠŸ"ç¡æ€"
  â†’ ç™½å¤©å¯ä»¥é€‚æ—¶é€éœ²ä¿¡æ¯ï¼ˆå¦‚æœè¯¥ç›®æ ‡æ˜¯ç‹¼ï¼‰

ã€æ€ç»´é“¾ï¼ˆå¿…é¡»å®Œæˆï¼‰ã€‘
Step1: æ˜¨æ™šå…¥æ¢¦å›é¡¾
  - æˆ‘å…¥æ¢¦äº†è°ï¼Ÿä¸ºä»€ä¹ˆå…¥æ¢¦TAï¼Ÿ
  - ä»Šæ—©TAçš„çŠ¶æ€å¦‚ä½•ï¼Ÿ

Step2: æ­»è®¯åˆ†æ
  - ä»Šæ—©è°å€’ç‰Œäº†ï¼Ÿ
  - è¿™ä¸æˆ‘çš„å…¥æ¢¦æœ‰å…³å—ï¼Ÿ
  - æ˜¯å¦æš´éœ²äº†æˆ‘çš„èº«ä»½ï¼Ÿ

Step3: ç‹¼äººæ’æŸ¥
  - åœºä¸Šè°æœ€å¯èƒ½æ˜¯ç‹¼ï¼Ÿ
  - æ˜¯å¦éœ€è¦å¯åŠ¨è¿æ¢¦å‡»æ€è®¡åˆ’ï¼Ÿ

Step4: å‘è¨€å†…å®¹ç¡®å®š
  - æˆ‘åº”è¯¥éšè—èº«ä»½è¿˜æ˜¯è·³èº«ä»½ï¼Ÿ
  - å¦‚æœè·³èº«ä»½ï¼Œå¦‚ä½•æŠ¥å…¥æ¢¦åå•ï¼Ÿ
  - è¯­æ°”è¦å†·é™ã€ç†æ€§

Step5: æŠ•ç¥¨å€¾å‘
  - åŸºäºå½“å‰é€»è¾‘ï¼Œåº”è¯¥æŠ•è°ï¼Ÿ
  - æ˜¯å¦éœ€è¦ä¿æŠ¤çœŸé¢„è¨€å®¶ï¼Ÿ

è¾“å‡ºJSON:{\"thought\":\"å®Œæ•´çš„5æ­¥æ€ç»´é“¾\",\"speech\":\"å‘è¨€å†…å®¹(40-80å­—)\",\"confidence\":0-100,\"voteIntention\":æ•°å­—æˆ–-1,\"identity_table\":{\"ç©å®¶å·\":{\"suspect\":\"è§’è‰²\",\"confidence\":0-100,\"reason\":\"ä¾æ®\"}}}`;
};

/**
 * æ‘„æ¢¦äººæŠ•ç¥¨æç¤ºè¯
 */
export const getDreamweaverVotePrompt = (params) => {
  const { aliveTargets, voteContext } = params;

  return `æ‘„æ¢¦äººæŠ•ç¥¨å†³ç­–ã€‚
ã€å¯æŠ•ç¥¨ç›®æ ‡ã€‘${aliveTargets.join(',')}å·
${voteContext || ''}

ã€æŠ•ç¥¨ç­–ç•¥ã€‘
1. ä¼˜å…ˆæŠ•ç¡®è®¤çš„ç‹¼äºº
2. ä¿æŠ¤ä½ è®¤ä¸ºæ˜¯çœŸé¢„è¨€å®¶çš„ç›®æ ‡
3. å¦‚æœä½ å·²ç»è·³èº«ä»½ï¼Œå‘æŒ¥é¢†è¢–ä½œç”¨å¸¦é¢†å¥½äºº
4. å¦‚æœæœªè·³èº«ä»½ï¼Œåƒå¹³æ°‘ä¸€æ ·æŠ•ç¥¨

è¾“å‡ºJSON:{\"targetId\":æ•°å­—,\"reasoning\":\"æŠ•ç¥¨ç†ç”±\"}`;
};

export const DREAMWEAVER_PROMPTS = {
  persona: DREAMWEAVER_PERSONA,
  getThinkingDimensions: getDreamweaverThinkingDimensions,
  getPriorities: getDreamweaverPriorities,
  buildPersonaPrompt: buildDreamweaverPersonaPrompt,
  nightAction: getDreamweaverNightPrompt,
  daySpeech: getDreamweaverDaySpeechPrompt,
  vote: getDreamweaverVotePrompt
};
